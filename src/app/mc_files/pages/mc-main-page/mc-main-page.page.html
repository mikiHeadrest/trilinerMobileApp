<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">ventanaMonitoreo</ion-title>
    </ion-toolbar>
  </ion-header>
  <!-- Operaciones activas -->
  <div class="tituloOperacion">Operaciones Activas</div>
  <div class="divModelo">Modelo: {{ maquinas[0]?.modelo}}</div>

  <div class="divOperaciones">

    <!-- Estado -->
    <div class="divSeparador">
      <!-- Izquierda -->
      <div class="divIzquierdoFondo">
        <img src="assets/almacen.jpg" class="fondoAlmacen" />
        <div class="overlayTexto">
          <div class="estadoTextoGrande">Estado:</div>
          <div class="estadoTextoGrande">En Operación</div>
        </div>
      </div>

      <!-- Derecha -->
      <div class="divDerecho">
        <div class="filaOperacion">
          <p>Tipo de Operación: {{opsInv[0]?.tipo}}</p>
          <p><strong>ID_Operación: {{opsInv[0]?.id}}</strong></p>
        </div>

        <div class="contenidoDerecho">
          <!-- 1. Tarjeta amarilla -->
          <div class="estadoAmarillo">
            <img src="" class="estadoImg" />
            <div>
              <div><strong>Estado:</strong> Acomodado en Almacén</div>

              <div class="estadoId">ID: 000 000 004</div>
            </div>
            <div class="estadoUnidades">
              <ion-icon name="arrow-down-outline"></ion-icon>
              <!-- Yo creo que para las unidades van a ser inserciones unicas y haremos una funcion para sumar las veces que sale en el inventario e inactivo y el mismo producto
               y ese seria el total, en este caso 2, pero seria ver como hacer para cuando se complete 1, aun no se como hacerlo-->
              <div class="unidadesTexto">1/{{movs[0].unidades}} <br><strong>Unidades</strong></div>
            </div>
          </div>

          <!-- 2. Tarjetas de resumen -->
          <div class="tarjetaResumen despacho">
            <div><strong>Despachos Realizadas</strong><div>{{fechaActual}}</div></div>
            <div class="numeroResumen">{{totalDespacho}}</div>
          </div>
          <div class="tarjetaResumen recepcion">
            <div><strong>Recepciones Realizadas</strong><div>{{fechaActual}}</div></div>
            <div class="numeroResumen">{{totalRecepcion}}</div>
          </div>
        </div>
      </div>

    </div>

    <!-- Botones -->
    <ion-grid class="divBotones" fixed>
      <ion-row class="botones-row">
        <ion-col size="4" class="boton-col">
          <ion-button class="btnAccion btnRojo"><b>DETENER</b></ion-button>
        </ion-col>
        <ion-col size="4" class="boton-col">
          <ion-button class="btnAccion btnVerde">RENUDAR</ion-button>
        </ion-col>
        <ion-col size="4" class="boton-col">
          <ion-button class="btnAccion btnAmarillo">PAUSAR</ion-button>
        </ion-col>
      </ion-row>
    </ion-grid>


    <!-- Últimas operaciones -->
    <p class="subtitulo">Ultimas operaciones realizadas</p>
    <div class="divUltimas">
      <!-- Falta el ngFor -->
      <ng-container *ngIf="movs?.length; else sinMovs">
        <ion-item lines="none" class="cardOperacion"
                  *ngFor="let m of movs; trackBy: trackById">

          <ion-avatar slot="start">
            <img [src]="productoDe(m.productoId)?.imagen || 'assets/placeholder.png'" />
          </ion-avatar>

          <ion-label>
            <p style="color: white;">
              {{ m.tipo }} de
              <strong>{{ productoDe(m.productoId)?.nombre || 'Producto' }}</strong>
            </p>
            <p>
              {{ m.createdAt}}
              <span>OR: {{ productoDe(m.productoId)?.franquicia || 'UPS' }}</span><br>
              ID Producto: {{ m.productoId }}
            </p>
          </ion-label>

          <div style="align-items:center; justify-content:center; display:flex; flex-direction:column;">
            <ion-icon slot="end" [name]="iconoMovimiento(m)" style="font-size: 1.5rem;"></ion-icon>
            <p>{{ m.unidades }} Unidades</p>
          </div>

        </ion-item>
      </ng-container>

      <ng-template #sinMovs>
        <div class="empty-container">No hay movimientos</div>
      </ng-template>
    </div>

  </div>

  <!-- Nueva operación -->
  <div class="tituloOperacion">Asignar nueva Operación</div>
  <div class="divAsignar">
    <div class="opBox recepciones" style="border-bottom-right-radius: 70px; border: 2px solid #DCF0FF;">
      <p>Recepciones Manuales</p>
      <ion-icon name="cube-outline" size="large"></ion-icon>
    </div>
    <div class="opBox despachos" style="border-bottom-left-radius: 70px; border: 2px solid #D7C7B5;" (click)="irDespacho()">
      <p>Operación de Despacho</p>
      <ion-icon name="airplane-outline" size="large"></ion-icon>
    </div>
  </div>
</ion-content>
